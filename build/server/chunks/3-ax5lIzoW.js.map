{"version":3,"file":"3-ax5lIzoW.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/create/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/3.js"],"sourcesContent":["import { r as redirect } from \"../../../chunks/index.js\";\nimport \"../../../chunks/auth.js\";\nimport { f as formatRow, p as pool } from \"../../../chunks/db.js\";\nimport { randomUUID } from \"crypto\";\nimport unzipper from \"unzipper\";\nimport { mkdirSync, writeFileSync, createReadStream, unlinkSync, cpSync } from \"fs\";\nimport path from \"path\";\nconst load = async (event) => {\n  if (!event.locals.user)\n    redirect(302, \"/login?v=create\");\n  return;\n};\nconst actions = {\n  default: async (event) => {\n    const formData = await event.request.formData();\n    const label = formData.get(\"label\");\n    const description = formData.get(\"desc\");\n    const image = formData.get(\"img\");\n    const isTemplate = formData.get(\"using_template\");\n    const id = randomUUID();\n    const uploadPath = path.join(path.resolve(), `/static/files/${id}`);\n    if (!isTemplate) {\n      const fileField = formData.get(\"file\");\n      if (!fileField || !(fileField instanceof File)) {\n        return { status: 400, body: \"No file provided\" };\n      }\n      mkdirSync(uploadPath, { recursive: true });\n      const zipPath = `${uploadPath}/tempfile.zip`;\n      const arrayBuffer = await fileField.arrayBuffer();\n      console.log(fileField, arrayBuffer);\n      const uint8Array = new Uint8Array(arrayBuffer);\n      writeFileSync(zipPath, uint8Array);\n      await createReadStream(zipPath).pipe(unzipper.Extract({ path: uploadPath })).promise();\n      unlinkSync(zipPath);\n    } else {\n      const templateName = formData.get(\"template\");\n      const templatePath = path.join(path.resolve(), `/static/templates/${templateName}`);\n      cpSync(templatePath, uploadPath, { recursive: true });\n    }\n    let [query, params] = formatRow({\n      name: label,\n      state: \"public\",\n      image,\n      description,\n      user_id: event.locals.user.id,\n      uuid: id\n    });\n    await pool.execute(`insert into rooms ${query}`, params);\n    redirect(302, `/rooms/${id}`);\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/create/_page.server.ts.js';\n\nexport const index = 3;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/create/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/create/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/3.rOcVd_X1.js\",\"_app/immutable/chunks/2.0OfY4fVd.js\",\"_app/immutable/chunks/index.rEPfTm2O.js\",\"_app/immutable/chunks/sfondo.Be_BQm21.js\"];\nexport const stylesheets = [\"_app/immutable/assets/3.a2aKwU4n.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}